#!/bin/bash

echo "=== Debug: PR Filtering ==="
echo

echo "Testing if we see bot PRs in Kubernetes org (should be filtered out):"
gh search prs --owner=kubernetes --state=open --limit=10 --json title,author \
  | jq -r '.[] | select(.author.login | test("\\[bot\\]$")) | "\(.title) (by \(.author.login))"' \
  | head -5

echo
echo "Testing if we see 'chore:' PRs in Kubernetes (should be filtered out):"
gh search prs --owner=kubernetes --state=open --limit=20 --json title \
  | jq -r '.[] | select(.title | test("^chore:")) | .title' \
  | head -5

echo  
echo "Testing regular PRs in Kubernetes (should be included):"
gh search prs --owner=kubernetes --state=open --limit=5 --json title,author,createdAt \
  | jq -r '.[] | select(.author.login | test("\\[bot\\]$") | not) | "\(.title) (by \(.author.login) at \(.createdAt))"'

echo
echo "=== Conclusion ==="
echo "If you see bot PRs or 'chore:' PRs in the app, filtering is broken."
echo "If you don't see them, filtering is working correctly."